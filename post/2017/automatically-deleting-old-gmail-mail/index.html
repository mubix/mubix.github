<!DOCTYPE html>
<html>

    <head>
        <title> Automatically deleting old Gmail email &middot;  </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.31.1" />


<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://malicious.link/css/nix.css">


<link href="https://fonts.googleapis.com/css?family=Inconsolata|Open+Sans|Roboto|Montserrat|Concert+One" rel="stylesheet">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
	  ga('send', 'pageview');

</script>


    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" id="green-terminal" href=https://malicious.link/>mubix@malicious.link ~ $</a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="https://malicious.link/">/home/mubix</a>
				</li>
				
				
				<li >
					<a href="/brandon">~/brandon</a>
				</li>
				
				
				<li >
					<a href="/about">~/about</a>
				</li>
				
				
				<li >
					<a href="/post">~/posts</a>
				</li>
				

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="container wrapper">
            <h1><a href="https://malicious.link/post/2017/automatically-deleting-old-gmail-mail/">Automatically deleting old Gmail email</a></h1>
            <span class="post-date">Oct 12, 2017 </span>
            <div class="post-content">
                <p>Like many of you I&rsquo;m a gmail hoarder. I never deleting anything, just &ldquo;archive&rdquo; everything. I &ldquo;might&rdquo; need it later, or &ldquo;I&rsquo;ll get to it when I have time&rdquo;. If we get really honest with ourselves, we never will actually get to it, and because we have this buffer, this procrastination opportunity, we grab it. We use words like &ldquo;but I may need proof of X&rdquo;, or &ldquo;I could need to reference this&rdquo;, or &ldquo;I don&rsquo;t really want to put this person in my contacts so I&rsquo;ll just save the email&rdquo;.</p>

<p>Personally I have made a choice to force myself to be more engaged in my email going forward. I have set a Google Script to run through all of my email every day and if it is older than 90 days, and doesn&rsquo;t have the specail label &ldquo;keep&rdquo; on it, it&rsquo;s gone. I obviously didn&rsquo;t care enough about whatever was going on in that email to take the time to respond to it.</p>

<p>Whatever your reason for finding this post, here is how I got it done:</p>

<p>At first I started with just searching for a way to make a simple filter to do this. There are plenty of blog posts that show you this is possible, but it turns out that at some point Gmail switched to only applying filters to incoming messages (makes sense, lots less overhead, no need to load EVERYONEs email every hour). This makes deleting messages older than X impossible with simple filters however. I did however learn of a search query term you can use to find messages/threads older than X. Imaginatively called <code>older_than:</code>. So a search in Gmail for <code>older_than:90d</code> resulted in exactly the emails I wanted to find.</p>

<p>That&rsquo;s when I started looking into Google Scripting. The language is pretty easy and straight forward if you have ever programmed in anything like Javascript or C++.</p>

<p>Using the API reference here: <a href="https://developers.google.com/apps-script/reference/gmail/">https://developers.google.com/apps-script/reference/gmail/</a> I was able to cobble together the following in about 20 minutes:</p>

<pre><code>function DeleteOldEmail () {
	var threads;
	var thread;

	threads = GmailApp.search(&quot;older_than:90d&quot;);
	for(var i = 0; i &lt; threads.length; i++)
	{
		var thread = threads[i];
		GmailApp.moveThreadToTrash(thread);
	}
}
</code></pre>

<p>Now, that script leaves a lot to be desired. It doesn&rsquo;t have any case where a label like &ldquo;save&rdquo; or &ldquo;keep&rdquo; might come into play, it just hauls off and deletes everything old. But before we start improving lets show you how it looks when you&rsquo;re actually doing it (I&rsquo;ll comment out the &ldquo;moveThreadToTrash in the screenshots)</p>

<p>Go to <a href="https://script.google.com/">https://script.google.com/</a> and you&rsquo;ll be presented with a new project if you haven&rsquo;t been here before:</p>

<p><img src="/images/2017/gmail_delete_1.png" alt="" /></p>

<p>Then, copy and past the code in and save it. It&rsquo;ll ask you to name the project. I just named it DeleteOldEmail. Feel free to name it anything you wish. It is what is going to show up in your Google Security &ldquo;Approve Apps&rdquo; list.</p>

<p><img src="/images/2017/gmail_delete_2.png" alt="" /></p>

<p>The first time I ran this I commented out the lines for deleting and added in a &ldquo;Logger&rdquo; line just so I knew what would be deleted:</p>

<pre><code>function DeleteOldEmail () {
	var threads;
	var thread;

	threads = GmailApp.search(&quot;older_than:90d&quot;);
	for(var i = 0; i &lt; threads.length; i++)
	{
      var thread = threads[i];
      Logger.log(thread.getFirstMessageSubject())
		//GmailApp.moveThreadToTrash(thread);
	}
}
</code></pre>

<p>Then run it, the first time you run it, it will ask for permissions:</p>

<p><img src="/images/2017/gmail_delete_3.png" alt="" /></p>

<p>If you try this out and decide you don&rsquo;t like it you can revoke the permissions here: <a href="https://myaccount.google.com/permissions">https://myaccount.google.com/permissions</a></p>

<p><img src="/images/2017/gmail_delete_4.png" alt="" /></p>

<p>If you went with the logging you&rsquo;ll see something like this if you go to <strong>View-&gt;Logs</strong>:</p>

<p><img src="/images/2017/gmail_delete_5.png" alt="" /></p>

<p>Last step is to set this up so it automatically runs, I mean that&rsquo;s the whole point. For that, we go to <strong>Edit-&gt;Current Project&rsquo;s Triggers</strong>. And we are greeted with the following (once we click to add a new trigger):</p>

<p><img src="/images/2017/gmail_delete_6.png" alt="" /></p>

<p>I chose to set up mine to run every 12 hours, but you can set it to run once a day, once a week, whatever.</p>

<p>Again, this script leaves a lot to be desired, You can totally mess with the query search string any way you wish. I&rsquo;ve created a Github repository that I&rsquo;ll put improvements on the script: <a href="https://github.com/mubix/GScriptOldEmal">https://github.com/mubix/GScriptOldEmal</a></p>

<p>Have fun with it. The two improvments I&rsquo;ll be adding are the label exclusion for &ldquo;keep&rdquo; and notifications (a list of email subjects deleted)</p>

<p>Thanks for your time.</p>

            </div>
            
            <div class="post-comments">
                
            </div>
            
            <div class="push"></div>
        </div>
        <footer class="footer text-center">
<p>Copyright &copy; 2018 Malicious.Link -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>
</footer>

    </body>
