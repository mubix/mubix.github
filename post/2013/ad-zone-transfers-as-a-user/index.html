<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="cross posted from: http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html
The tired and true method for Zone Transfers are using either nslookup:
nslookup ls -d domain.com.local  Or dig:
dig -t AXFR domain.com.local @ns1.domain.com.local  In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &amp;lsquo;dnscmd&amp;rsquo; command like so:
dnscmd /EnumZones dnscmd /ZonePrint domain.com.local  Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point)." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://malicious.link/post/2013/ad-zone-transfers-as-a-user/" />


<title>
    
    AD Zone Transfers as a user :: malicious.link  â€” welcome
    
</title>



<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel="stylesheet"
    type="text/css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">


<link rel="stylesheet" href="https://malicious.link/scss/main.min.099699ab246bf26f50616f7c9f00c79d46110459d1bd727b2d07d6fc09ece082.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="AD Zone Transfers as a user">
<meta itemprop="description" content="cross posted from: http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html
The tired and true method for Zone Transfers are using either nslookup:
nslookup ls -d domain.com.local  Or dig:
dig -t AXFR domain.com.local @ns1.domain.com.local  In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:
dnscmd /EnumZones dnscmd /ZonePrint domain.com.local  Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point).">


<meta itemprop="datePublished" content="2013-10-04T11:30:44-05:00" />
<meta itemprop="dateModified" content="2013-10-04T11:30:44-05:00" />
<meta itemprop="wordCount" content="416">



<meta itemprop="keywords" content="windows,dns,activedirectory,dig,nslookup,dnscmd,adfind,powershell," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AD Zone Transfers as a user"/>
<meta name="twitter:description" content="cross posted from: http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html
The tired and true method for Zone Transfers are using either nslookup:
nslookup ls -d domain.com.local  Or dig:
dig -t AXFR domain.com.local @ns1.domain.com.local  In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:
dnscmd /EnumZones dnscmd /ZonePrint domain.com.local  Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point)."/>




<meta property="article:published_time" content="2013-10-04 11:30:44 -0500 -0500" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/post/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">boot mubix.kernel</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://malicious.link/about">About</a></li><li><a href="https://malicious.link/brandon">Brandon</a></li><li><a href="https://malicious.link/post">Posts</a></li><li><a href="https://malicious.link/start">Start</a></li><li><a href="https://malicious.link/tags">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://malicious.link/post/2013/ad-zone-transfers-as-a-user/">AD Zone Transfers as a user</a></h2>

            

            <div class="post-content">
                <p><em>cross posted from: <a href="http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html">http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html</a></em></p>

<p>The tired and true method for Zone Transfers are using either nslookup:</p>

<pre><code>nslookup
ls -d domain.com.local
</code></pre>

<p>Or dig:</p>

<pre><code>dig -t AXFR domain.com.local @ns1.domain.com.local
</code></pre>

<p>In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:</p>

<pre><code>dnscmd /EnumZones
dnscmd /ZonePrint domain.com.local
</code></pre>

<p>Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point).</p>

<p>You can also use PowerShell:</p>

<p><code>PS C:\Users\jdoe&gt; get-wmiobject -ComputerName dc1 -Namespace root\microsoftDNS -Class MicrosoftDNS_ResourceRecord -Filter &quot;domainname='projectmentor.net'&quot; | select textrepresentation</code></p>

<p>Again, this requires you to be a very high privileged account, which is no fun. I need these computer lists as part of my internal / post-exploitation recon, not an end step.</p>

<p>For the longest time I relied on a very awesome tool called &ldquo;Adfind&rdquo;:</p>

<pre><code>adfind -sc computers_active -csv -nodn -nocsvq -nocsvheader
</code></pre>

<p>This command will output a list of computer accounts that have been active in the last 90 days in a straight line by line format (hence all of the no &ldquo;this&rdquo;and no &ldquo;that&rdquo; flags)</p>

<p>But that wasn&rsquo;t good enough, this image kept haunting me:</p>

<p><img src="/images/2013/ad-dns-zone.png" alt="" /></p>

<p>It&rsquo;s Active Directory Explorer by SysInternals. It shows the complete list of DNS records, stored as objects in Active Directory that I was able to get to as a basic domain user. This means all of the static DNS records for the unix systems and mainframes and other systems outside of the purely Windows world are there as well.</p>

<p>I spent 4 days attempting to write my own script, ldap query, prayer to  get all of the data out but was unsuccessful. On the 5th day I happened upon a very short post saying &ldquo;I did it&rdquo;, as I probably would have written the same. It comes in the form of a PowerShell script that you can find here:</p>

<p>Code: <a href="https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1">https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1</a></p>

<p>And is very easy to run:</p>

<p><code>PS C:\Users\jdoe&gt; dns-dump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>or</p>

<p><code>C:\&gt; powershell -ep bypass -f dnsdump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>If you put a -csv on the end of those the author has even given you the CSV format which makes the output extremely easy to parse. Now you can throw your list into your tool of choice instead of scanning random IP ranges on the targets network for important stuff you can scan directly against known good hosts.</p>

<p>&ndash; mubix</p>

<p>P.S. Yes I realize this isn&rsquo;t actually &ldquo;Zone Transfer&rdquo;s but its close enough</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://malicious.link/tags/windows">windows</a></span><span class="tag"><a href="https://malicious.link/tags/dns">dns</a></span><span class="tag"><a href="https://malicious.link/tags/activedirectory">activedirectory</a></span><span class="tag"><a href="https://malicious.link/tags/dig">dig</a></span><span class="tag"><a href="https://malicious.link/tags/nslookup">nslookup</a></span><span class="tag"><a href="https://malicious.link/tags/dnscmd">dnscmd</a></span><span class="tag"><a href="https://malicious.link/tags/adfind">adfind</a></span><span class="tag"><a href="https://malicious.link/tags/powershell">powershell</a></span>
  				</p>
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
            <span></span>
            <span> <a href="https://malicious.link/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        





<script type="text/javascript" src="https://malicious.link/js/bundle.8a9ebda303dd50ff1cb0c1564c31e4da9d58924b7eef99f4694d22e8f690b6beb7bb0a08dad3bbe459354ed1aaa0d9bed9566c6e5b1b5b0c3e473adcc311cd89.js" integrity="sha512-ip69owPdUP8csMFWTDHk2p1Ykkt&#43;75n0aU0i6PaQtr63uwoI2tO75Fk1TtGqoNm&#43;2VZsblsbWww&#43;RzrcwxHNiQ=="></script>



    </body>
</html>
