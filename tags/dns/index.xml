<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Dns on Room362</title>
    <link>https://room362.com/tags/dns/</link>
    <description>Recent content in Dns on Room362</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2016. All rights reserved.</copyright>
    <lastBuildDate>Fri, 17 Jun 2016 07:35:28 -0500</lastBuildDate>
    <atom:link href="https://room362.com/tags/dns/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Linkedin NXDOMAINs - Purchased Pwnage</title>
      <link>https://room362.com/post/2016/linkedin-nxdomains/</link>
      <pubDate>Fri, 17 Jun 2016 07:35:28 -0500</pubDate>
      
      <guid>https://room362.com/post/2016/linkedin-nxdomains/</guid>
      <description>&lt;p&gt;I recently asked a friend if I could have just a list of the domains in the LinkedIn dump, no passwords, not full emails, just domains. I run a program that I lovingly call &amp;ldquo;DeepMagic&amp;rdquo; and I feed it domains whenever I can. Well, this time when I tossed the list of domains into the engine it started spitting out tons of errors. There was a total of &lt;strong&gt;9,436,804&lt;/strong&gt; unique domains names in the list, and for anyone who works with DNS that isn&amp;rsquo;t a very big number, so I didn&amp;rsquo;t think very much of it and didn&amp;rsquo;t know why it would choke on a list that small.&lt;/p&gt;

&lt;p&gt;When I looked at the logs I noticed that there was a very large percentage of the domains that were coming up with NXDOMAIN. Most of the time this means that the domain isn&amp;rsquo;t registered, but can also mean that no name servers are registered for the domain (this usually happens when a corporation doesn&amp;rsquo;t want to maintain the domain but still wants to hold onto it for brand management).&lt;/p&gt;

&lt;p&gt;I let the resolution keep going and just parsed out all of the NXDOMAINs, but when I saw the list of NXDOMAINs go over 90,000 and I wasn&amp;rsquo;t even out of the &amp;lsquo;A&amp;rsquo;s yet, I took a different approach. I sorted the list by count to find the most used domains (using of course my favorite &lt;code&gt;sort | uniq -c | sort -n&lt;/code&gt; that I think everyone who&amp;rsquo;s ever done text parsing on Linux knows).&lt;/p&gt;

&lt;p&gt;It lead to a few surprises, first, people still use AOL and earthlink?&lt;/p&gt;

&lt;p&gt;Second&amp;hellip; well just look for yourself:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;32952409 gmail.com
24071552 hotmail.com
20421035 yahoo.com
4283225 aol.com
1983431 comcast.net
1431727 yahoo.co.in
1337019 msn.com
1041953 sbcglobal.net
1039635 rediffmail.com
995709 yahoo.fr
916458 yahoo.co.uk
845570 live.com
841415 yahoo.com.br
750175 hotmail.co.uk
742597 verizon.net
575381 hotmail.fr
530308 ymail.com
529548 cox.net
510463 bellsouth.net
504339 libero.it
480006 att.net
429760 yahoo.es
407687 btinternet.com
396313 mail.ru
376970 googlemail.com
307292 earthlink.net
304012 mac.com
266076 yahoo.in
262010 yahoo.ca
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;rsquo;ve never heard of rediffmail, you?&lt;/p&gt;

&lt;p&gt;Anyways, I pushed the list in this order into a simple script:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat domains_count.txt | xargs -P 100 -n 2 sh -c &#39;./findnx2.sh $1 $2&#39; argv0 | tee nxdomains.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is what is in &lt;code&gt;findnx2.sh&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash
lines=$(nslookup ${2} | grep NXDOMAIN | wc -l)
if [ $lines -eq &amp;quot;1&amp;quot; ]
then
	echo &amp;quot;$2 is open with count $1&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And out popped a pretty interesting list (top 50):&lt;/p&gt;

&lt;p&gt;domain -&amp;gt; number of email accounts registered under that domain (based on number of occurrences of the domain in the unfiltered list):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;XXXXXXXXXXX is open with count 7606
hotmail.con is open with count 4367
c2i.net is open with count 3966
yahoo.con is open with count 3487
gmail.con is open with count 3249
90wewhelp.ru is open with count 3218
csupomona.edu is open with count 2844
us.ing.com is open with count 2622
test.linkedin.com is open with count 2583
wowhackgold.com is open with count 2515
yahoo.om is open with count 2461
alltel.net is open with count 6565
w.cn is open with count 2451
uolsinectis.com.ar is open with count 2315
gmail.fr is open with count 2830
gmail.om is open with count 2122
hotmail.cm is open with count 2044
alltel.com is open with count 2046
hotmail.om is open with count 1901
memo.ikea.com is open with count 1809
chicagogsb.edu is open with count 1758
gawab.com is open with count 2141
mscd.edu is open with count 1740
mayalasr.com is open with count 1626
yavvaram.com is open with count 1424
twtelecom.com is open with count 1448
asbada5m.com is open with count 1371
eunet.yu is open with count 1272
camerabuy.info is open with count 1156
mywdo.com is open with count 1275
g.mail.com is open with count 1089
nortelnetworks.com is open with count 1815
infotechsw.com is open with count 1040
saugov.sa.gov.au is open with count 1033
hoyllmail.com is open with count 1028
mn.rr.com is open with count 1029
apollogrp.edu is open with count 980
gemail.com is open with count 1086
v4q.info is open with count 928
hoylmail.com is open with count 915
yahoo.coom is open with count 890
ifrance.com is open with count 917
justafou.com is open with count 886
2008radiochat.info is open with count 879
myclearwave.net is open with count 967
tconl.com is open with count 939
gmail.cim is open with count 849
flykingfisher.com is open with count 866
lycos.co.uk is open with count 1092
pichosti.info is open with count 813
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Basic analysis of this list:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;I thought that LinkedIn validated sign ups with an email, kinda hard to do with all these domains that are obviously mistyped, unless of course they just keep the database record around indefinitely&lt;/li&gt;
&lt;li&gt;XXXXXXXXX is an ISP that went out of business in 2011, their domain is available for register and would probably mean 7606 accounts up for grabs, if not more that&amp;rsquo;s why I redacted it, but I wanted to mention it just to demonstrate how powerful this type of analysis of a hacked site&amp;rsquo;s dump can be. $10 to purchase a domain is much cheaper and more wide spread than cracking time passwords just for LinkedIn (well, one can dream that everyone uses unique passwords).&lt;/li&gt;
&lt;li&gt;WoWHackGold was also up for grabs, I picked it up just to see what kind of traffic is still going to it, these guys sold hacked WoW accounts so I don&amp;rsquo;t particularly feel inclined protect their info.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;What can someone do with this knowledge? Well, all they have to do to reset any of the accounts registered with one of these domains is simply purchase it, set up a catch-all email address and watch the account information roll in. The &amp;ldquo;accounts&amp;rdquo; they would have access to isn&amp;rsquo;t limited to LinkedIn either, could be anything that people use email addresses to sign up for.&lt;/p&gt;

&lt;p&gt;/mubix&lt;/p&gt;

&lt;p&gt;P.S. I have seen account take-overs of GMail accounts using &amp;ldquo;backup&amp;rdquo; accounts in this way. I assume Google has too since they ask me every so often now to make sure my backup email is correct.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>WPAD Persistence</title>
      <link>https://room362.com/post/2016/wpad-persistence/</link>
      <pubDate>Sun, 22 May 2016 21:55:12 -0400</pubDate>
      
      <guid>https://room362.com/post/2016/wpad-persistence/</guid>
      <description>

&lt;p&gt;Mostly just writing this so I can keep notes.&lt;/p&gt;

&lt;p&gt;Today I came up with the idea to forcibly put the WPAD entry into a Windows Domain&amp;rsquo;s DNS. For those who don&amp;rsquo;t know what this would do there is an entire Wikipedia article on the subject: &lt;a href=&#34;https://en.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol&#34;&gt;https://en.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I did this via PowerShell pretty easily on one of the domain controllers like so:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;PS C:\&amp;gt; Add-DnsServerResourceRecordA -Name wpad -ZoneName sittingduck.info -IPv4Address 107.170.50.74
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Where 107.170.50.74 is the Digital Ocean box I stood up external to my test domain. I installed a basic web server and went to test my brilliant idea, but I wasn&amp;rsquo;t getting any requests for &lt;code&gt;wpad.dat&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;As they say &amp;ldquo;there are no more original ideas&amp;rdquo; it looks like the awesome people at Microsoft not only had this idea but fixed it way back in 2008.&lt;/p&gt;

&lt;p&gt;but.. they also made a way to disable it - &lt;a href=&#34;https://technet.microsoft.com/en-us/library/cc995158.aspx&#34;&gt;Removing WPAD from DNS block list&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Running the DNS entry update will propagate throughout the domain so you only have to set that once, however the block list is per domain controller (or DNS server if they are separated, which is rare these days as it&amp;rsquo;s a required service in later Windows server versions).&lt;/p&gt;

&lt;p&gt;I went in search of a registry key to make the modification because it&amp;rsquo;s much easier to hit the &lt;code&gt;RemoteRegistry&lt;/code&gt; service on all the DCs than it is to run that command. I quickly found this blog post - &lt;a href=&#34;http://dns-info.blogspot.com/2009/01/enableglobalqueryblocklist-registry-key.html&#34;&gt;EnableGlobalQueryBlockLisst registry key&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A quick batch script to loop through each DomainController in the domain and I started getting a bunch of requests.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[22/May/2016:21:56:28 EDT] &amp;quot;GET /wpad.dat HTTP/1.1&amp;quot; 200 58
- -&amp;gt; /wpad.dat
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, you may be asking, &amp;ldquo;How is setting their proxy server any kind of real persistence?&amp;rdquo;, I implore you to go check out projects like &lt;a href=&#34;https://mitmproxy.org/&#34;&gt;mitmproxy&lt;/a&gt;, &lt;a href=&#34;https://github.com/byt3bl33d3r/MITMf&#34;&gt;mitmf&lt;/a&gt; and &lt;a href=&#34;https://github.com/secretsquirrel/BDFProxy&#34;&gt;BDFProxy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pentesters have been recommending for years to put a WPAD entry into DNS to protect against LAN based attackers with Responder. Who knew it actually didn&amp;rsquo;t do anything because Microsoft was blocking those lookups anyways. So, if you have better solutions for WPAD on an Enterprise domain please leave a comment below. (Turning off the setting is a per-user per-system setting and doesn&amp;rsquo;t disable it for the SYSTEM or other local accounts, so it&amp;rsquo;s harder than just &amp;ldquo;flip on this registry setting via GPO&amp;rdquo;)&lt;/p&gt;

&lt;p&gt;Oh and I&amp;rsquo;ll just leave this here: &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/ee309366%28v=vs.85%29.aspx&#34;&gt;Proxy servers and WinRM&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;references&#34;&gt;References&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://technet.microsoft.com/en-us/library/cc995158.aspx&#34;&gt;Removing WPAD from DNS block list&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://dns-info.blogspot.com/2009/01/enableglobalqueryblocklist-registry-key.html&#34;&gt;EnableGlobalQueryBlockLisst registry key&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/ee309366%28v=vs.85%29.aspx&#34;&gt;Proxy servers and WinRM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mitmproxy.org/&#34;&gt;mitmproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/byt3bl33d3r/MITMf&#34;&gt;mitmf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/secretsquirrel/BDFProxy&#34;&gt;BDFProxy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>