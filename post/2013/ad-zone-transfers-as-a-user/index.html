<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>AD Zone Transfers as a user &middot; Rob &#39;mubix&#39; Fuller</title>
        <meta name="description" content="cross posted from: http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html
The tired and true method for Zone Transfers are using either nslookup:
nslookup ls -d domain.com.local  Or dig:
dig -t AXFR domain.com.local @ns1.domain.com.local  In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:
dnscmd /EnumZones dnscmd /ZonePrint domain.com.local  Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point).">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.27.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://room362.com/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Room362" href="https://room362.com/">Room362</a>
                            </h1>
                        
                        <a class="button-square" href="https://room362.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/mubix">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/mubix">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/mubix">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Google+" title="Google+" href="https://google.com/&#43;mubix">
                                <i class="fa fa-google-plus"></i>
                            </a>
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Brandon" href="/brandon/">Brandon</a>
    </li>

    <li class="site-nav-item">
        <a title="About Me" href="/about/">About Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Start in Infosec" href="/start/">Start in Infosec</a>
    </li>

    <li class="site-nav-item">
        <a title="Attacker KB" href="https://attackerkb.com/">Attacker KB</a>
    </li>

    <li class="site-nav-item">
        <a title="Projects" href="/projects/">Projects</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">AD Zone Transfers as a user</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2013-10-04" itemprop="datePublished">Fri, Oct 4, 2013</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://twitter.com/mubix" itemprop="url" rel="author">Rob &#39;mubix&#39; Fuller</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p><em>cross posted from: <a href="http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html">http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html</a></em></p>

<p>The tired and true method for Zone Transfers are using either nslookup:</p>

<pre><code>nslookup
ls -d domain.com.local
</code></pre>

<p>Or dig:</p>

<pre><code>dig -t AXFR domain.com.local @ns1.domain.com.local
</code></pre>

<p>In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:</p>

<pre><code>dnscmd /EnumZones
dnscmd /ZonePrint domain.com.local
</code></pre>

<p>Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point).</p>

<p>You can also use PowerShell:</p>

<p><code>PS C:\Users\jdoe&gt; get-wmiobject -ComputerName dc1 -Namespace root\microsoftDNS -Class MicrosoftDNS_ResourceRecord -Filter &quot;domainname='projectmentor.net'&quot; | select textrepresentation</code></p>

<p>Again, this requires you to be a very high privileged account, which is no fun. I need these computer lists as part of my internal / post-exploitation recon, not an end step.</p>

<p>For the longest time I relied on a very awesome tool called &ldquo;Adfind&rdquo;:</p>

<pre><code>adfind -sc computers_active -csv -nodn -nocsvq -nocsvheader
</code></pre>

<p>This command will output a list of computer accounts that have been active in the last 90 days in a straight line by line format (hence all of the no &ldquo;this&rdquo;and no &ldquo;that&rdquo; flags)</p>

<p>But that wasn&rsquo;t good enough, this image kept haunting me:</p>

<p><img src="/images/2013/ad-dns-zone.png" alt="" /></p>

<p>It&rsquo;s Active Directory Explorer by SysInternals. It shows the complete list of DNS records, stored as objects in Active Directory that I was able to get to as a basic domain user. This means all of the static DNS records for the unix systems and mainframes and other systems outside of the purely Windows world are there as well.</p>

<p>I spent 4 days attempting to write my own script, ldap query, prayer to  get all of the data out but was unsuccessful. On the 5th day I happened upon a very short post saying &ldquo;I did it&rdquo;, as I probably would have written the same. It comes in the form of a PowerShell script that you can find here:</p>

<p>Code: <a href="https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1">https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1</a></p>

<p>And is very easy to run:</p>

<p><code>PS C:\Users\jdoe&gt; dns-dump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>or</p>

<p><code>C:\&gt; powershell -ep bypass -f dnsdump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>If you put a -csv on the end of those the author has even given you the CSV format which makes the output extremely easy to parse. Now you can throw your list into your tool of choice instead of scanning random IP ranges on the targets network for important stuff you can scan directly against known good hosts.</p>

<p>&ndash; mubix</p>

<p>P.S. Yes I realize this isn&rsquo;t actually &ldquo;Zone Transfer&rdquo;s but its close enough</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/windows/">windows</a>, 
            
                <a href="/tags/dns/">dns</a>, 
            
                <a href="/tags/activedirectory/">activedirectory</a>, 
            
                <a href="/tags/dig/">dig</a>, 
            
                <a href="/tags/nslookup/">nslookup</a>, 
            
                <a href="/tags/dnscmd/">dnscmd</a>, 
            
                <a href="/tags/adfind/">adfind</a>, 
            
                <a href="/tags/powershell/">powershell</a>
            
        </p>
    

    <a class="muut" href="https://muut.com/i/room362/comments" type="dynamic">room362</a> <script src="//cdn.muut.com/1/moot.min.js"></script>

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=AD%20Zone%20Transfers%20as%20a%20user&url=https%3a%2f%2froom362.com%2fpost%2f2013%2fad-zone-transfers-as-a-user%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2froom362.com%2fpost%2f2013%2fad-zone-transfers-as-a-user%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
            <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2froom362.com%2fpost%2f2013%2fad-zone-transfers-as-a-user%2f"
              onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
              <i class="fa fa-google-plus"></i>
                <span class="hidden">Google+</span>
            </a>
        
        
    </div>
</footer>


        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Room362" href="https://room362.com/">Room362</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2017 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://room362.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script src="https://room362.com/js/jquery.fitvids.js"></script>
        <script src="https://room362.com/js/scripts.js"></script>
    </body>
</html>

