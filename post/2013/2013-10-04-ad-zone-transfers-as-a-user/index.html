<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    AD Zone Transfers as a user // Room362
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.16" />

  <meta property="og:title" content="AD Zone Transfers as a user" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://room362.com/post/2013/2013-10-04-ad-zone-transfers-as-a-user/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="https://room362.com//css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Room362" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	
	  <img src="/images/headshot_small.png" class="sidebarphoto">
	

    <h1 class="brand-title">Room362</h1>
    <h2 class="brand-tagline">Blatherings of a security addict</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://room362.com/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/brandon/">Brandon</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/about/">About</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="/index.xml" target="_blank"><i class='fa fa-rss'></i></a>
        
      
        
        <a href="https://linkedin.com/in/mubix" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="https://twitter.com/mubix" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/post/2013/2013-10-04-ad-zone-transfers-as-a-user/">AD Zone Transfers as a user</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>4</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Oct</span> <span class="post-date-year">2013</span>
            	</span>
            	
            
            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-active-directory" href="https://room362.com//categories/active-directory">active directory</a>
				
					<a class="post-category post-category-powershell" href="https://room362.com//categories/powershell">powershell</a>
				
					<a class="post-category post-category-cli" href="https://room362.com//categories/cli">cli</a>
				
				</div>
			

			

			

            <p><em>cross posted from: <a href="http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html">http://carnal0wnage.attackresearch.com/2013/10/ad-zone-transfers-as-user.html</a></em></p>

<p>The tired and true method for Zone Transfers are using either nslookup:</p>

<pre><code>nslookup
ls -d domain.com.local
</code></pre>

<p>Or dig:</p>

<pre><code>dig -t AXFR domain.com.local @ns1.domain.com.local
</code></pre>

<p>In the Windows Enterprise world there are a few more options. If you are a DNS Admin you can use the &lsquo;dnscmd&rsquo; command like so:</p>

<pre><code>dnscmd /EnumZones
dnscmd /ZonePrint domain.com.local
</code></pre>

<p>Which is handy if you can pop the DNS server (usually the Domain Controller so you usually have better things to do at that point).</p>

<p>You can also use PowerShell:</p>

<p><code>PS C:\Users\jdoe&gt; get-wmiobject -ComputerName dc1 -Namespace root\microsoftDNS -Class MicrosoftDNS_ResourceRecord -Filter &quot;domainname='projectmentor.net'&quot; | select textrepresentation</code></p>

<p>Again, this requires you to be a very high privileged account, which is no fun. I need these computer lists as part of my internal / post-exploitation recon, not an end step.</p>

<p>For the longest time I relied on a very awesome tool called &ldquo;Adfind&rdquo;:</p>

<pre><code>adfind -sc computers_active -csv -nodn -nocsvq -nocsvheader
</code></pre>

<p>This command will output a list of computer accounts that have been active in the last 90 days in a straight line by line format (hence all of the no &ldquo;this&rdquo;and no &ldquo;that&rdquo; flags)</p>

<p>But that wasn&rsquo;t good enough, this image kept haunting me:</p>

<p><img src="/images/postimages/201310_zonetransfer_1.png" alt="" /></p>

<p>It&rsquo;s Active Directory Explorer by SysInternals. It shows the complete list of DNS records, stored as objects in Active Directory that I was able to get to as a basic domain user. This means all of the static DNS records for the unix systems and mainframes and other systems outside of the purely Windows world are there as well.</p>

<p>I spent 4 days attempting to write my own script, ldap query, prayer to  get all of the data out but was unsuccessful. On the 5th day I happened upon a very short post saying &ldquo;I did it&rdquo;, as I probably would have written the same. It comes in the form of a PowerShell script that you can find here:</p>

<p>Code: <a href="https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1">https://github.com/mmessano/PowerShell/blob/master/dns-dump.ps1</a></p>

<p>And is very easy to run:</p>

<p><code>PS C:\Users\jdoe&gt; dns-dump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>or</p>

<p><code>C:\&gt; powershell -ep bypass -f dnsdump.ps1 -zone projectmentor.net -dc dc1</code></p>

<p>If you put a -csv on the end of those the author has even given you the CSV format which makes the output extremely easy to parse. Now you can throw your list into your tool of choice instead of scanning random IP ranges on the targets network for important stuff you can scan directly against known good hosts.</p>

<p>&ndash; mubix</p>

<p>P.S. Yes I realize this isn&rsquo;t actually &ldquo;Zone Transfer&rdquo;s but its close enough</p>

	
			

			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/post/2013/2013-10-05-dumping-a-domain-worth-of-passwords-with-mimikatz/">Dumping a domain worth of passwords with mimikatz</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/post/2013/2013-09-11-stealing-passwords-every-time-they-change/">Stealing passwords every time they change</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;
    if (window.location.hostname == "127.0.0.1")
        return;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'room362';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
			<li><a href="/about">About</a></li>
		
			<li><a href="/post">Blog</a></li>
		
		</ul>
	</div>

	<p>&copy; 2016. All rights reserved.</p>
</div>
    </div>
  </div>
	

	

  
</body>
</html>
