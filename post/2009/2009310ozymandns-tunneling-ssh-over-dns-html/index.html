<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    OzymanDNS - Tunneling SSH over DNS // Room362
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="mubix">
<meta name="generator" content="Hugo 0.16" />

  <meta property="og:title" content="OzymanDNS - Tunneling SSH over DNS" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://room362.com/post/2009/2009310ozymandns-tunneling-ssh-over-dns-html/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="https://room362.com//css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Room362" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	
	  <img src="/images/headshot_small.png" class="sidebarphoto">
	

    <h1 class="brand-title">Room362</h1>
    <h2 class="brand-tagline">Blatherings of a security addict</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://room362.com/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/brandon/">Brandon</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/about/">About</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="/index.xml" target="_blank"><i class='fa fa-rss'></i></a>
        
      
        
        <a href="https://linkedin.com/in/mubix" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="https://twitter.com/mubix" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
		    <div id="toc" class="pure-u-1 pure-u-md-1-4">
				<small class="toc-label">Contents</small>
		   	 	<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#hak5-episode-504-shownotes-http-www-hak5-org-episodes-episode-504"><a href="http://www.hak5.org/episodes/episode-504">Hak5 Episode 504 Shownotes</a></a></li>
<li><a href="#disclaimer-i-in-no-way-endorse-illegal-activities-use-the-following-guide-in-a-test-environment-or-at-your-own-legal-risk">DISCLAIMER - I IN NO WAY ENDORSE ILLEGAL ACTIVITIES - USE THE FOLLOWING GUIDE IN A TEST ENVIRONMENT OR AT YOUR OWN LEGAL RISK.</a></li>
<li><a href="#step-1-dns-setup">Step 1 - DNS Setup:</a></li>
<li><a href="#step-2-server-setup">Step 2 - Server Setup:</a></li>
<li><a href="#step-3-client-connection">Step 3 - Client Connection:</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
		    </div>
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/post/2009/2009310ozymandns-tunneling-ssh-over-dns-html/">OzymanDNS - Tunneling SSH over DNS</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>10</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Mar</span> <span class="post-date-year">2009</span>
            	</span>
            	
            
            	
            		<span class="post-author-single">By <a class="post-author"  target="">mubix</a></span>
            		




            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-hak5" href="https://room362.com//categories/hak5">hak5</a>
				
					<a class="post-category post-category-dan-kaminskey" href="https://room362.com//categories/dan-kaminskey">dan kaminskey</a>
				
					<a class="post-category post-category-dns" href="https://room362.com//categories/dns">dns</a>
				
				</div>
			

			

			

            

<h3 id="hak5-episode-504-shownotes-http-www-hak5-org-episodes-episode-504"><a href="http://www.hak5.org/episodes/episode-504">Hak5 Episode 504 Shownotes</a></h3>

<p><em>(In the episode I say that it&rsquo;s cross platform, use the release links for the Windows binaries to get it working on windows or use cygwin)</em></p>

<h3 id="disclaimer-i-in-no-way-endorse-illegal-activities-use-the-following-guide-in-a-test-environment-or-at-your-own-legal-risk">DISCLAIMER - I IN NO WAY ENDORSE ILLEGAL ACTIVITIES - USE THE FOLLOWING GUIDE IN A TEST ENVIRONMENT OR AT YOUR OWN LEGAL RISK.</h3>

<p><strong>UPDATE</strong>:Thanks to <a href="http://carnal0wnage.blogspot.com/">Chris Gates</a> and <a href="http://www.digininja.org/index.php">Robin Wood</a> for pointing me towards a fixed up version of OzymanDNS and a great tutorial: <a href="http://www.splitbrain.org/blog/2008-11/02-dns_tunneling_made_simple">HERE</a></p>

<p><strong>UPDATE 2</strong>: Since Ozyman is no longer hosted on Dan&rsquo;s site, I have posted it here:</p>

<p>Download: <a href="https://github.com/mubix/stuff/blob/master/stolen/ozymandns_src_0.1.tgz?raw=true">ozymandns_src_0.1.tgz</a></p>

<p><strong>(Until of course/if he asks me to take it down)</strong></p>

<p>DNS Tunneling isn&rsquo;t new. <a href="http://www.doxpara.com/">Dan Kaminsky</a>&rsquo;s post for <a href="http://www.doxpara.com/?p=51">OzymanDNS&rsquo; release</a> was July 29th 2004 (There was DNS Tunneling linux packages dating back to the late 90s even). I will however comment that it&rsquo;s still in it&rsquo;s release version, but very functional. Also, DNS Tunnel isn&rsquo;t &ldquo;Big News&rdquo; so it really hasn&rsquo;t been &lsquo;mitigated&rsquo; anywhere yet. Everywhere I have tested it, it has worked, even behind a certain switch that rhymes with &lsquo;Panera&rsquo;</p>

<p>What does OzymanDNS do? It has two parts, server, and client. The server is a set and forget. It sits there waiting for a connection (caveat: from anywhere) But we are getting ahead of ourselves, lets setup up DNS first.</p>

<p>(I&rsquo;m going to assume that you have a SSH server somewhere that you have already setup)</p>

<h3 id="step-1-dns-setup">Step 1 - DNS Setup:</h3>

<p>Each &ldquo;Domain Manager&rdquo; or DNS Server has a different set up,  So I&rsquo;m not going to go into the details. The jist of the change you need to make is either make a domain or a subdomain that points it&rsquo;s nameserver records towards the host that you are running your server on.</p>

<ul>
<li><code>ihaztunnel.room362.com IN NS mubixpwnsyour.homedns.org</code>
<br /></li>
</ul>

<p>In this example we have setup a subdomain called &ldquo;ihaztunnel&rdquo; and set it&rsquo;s Name Server Record pointing to a dynamic dns host that points at the location of my OzymanDNS server.</p>

<h3 id="step-2-server-setup">Step 2 - Server Setup:</h3>

<p>You need <a href="http://www.perl.org/">Perl</a>, the <a href="http://search.cpan.org/~danpeder/MIME-Base32-1.01/Base32.pm">MIME::Base32</a>, and <a href="http://search.cpan.org/~olaf/Net-DNS-0.65/lib/Net/DNS.pm">Net::DNS</a> modules. After that you just run nomde.pl from whatever directory that you extracted the OzymanDNS scripts with the following context:</p>

<ul>
<li><code>./nomed.pl -i 0.0.0.0 ihaztunnel.room362.com</code></li>
</ul>

<p>This tells it to listen on any IP the host has (you can specifiy one if you wish), and tells it the DNS name that it&rsquo;s supporting. Don&rsquo;t forget to do port forwarding on your router or whatever may be in the way of port 53 UDP and TCP coming inbound. Also keep in mind that your ISP may be blocking, so field test the connection before you try to use it in the wild.</p>

<h3 id="step-3-client-connection">Step 3 - Client Connection:</h3>

<p>For the client, the setup is the same, get perl, the modules and OzymanDNS. Then you run the following command:</p>

<ul>
<li><code>ssh -D 8080 -C -o ProxyCommand=&quot;/home/mubix/ozymandns/droute.pl whatever.ihaztunnel.room362.com&quot; room362.com</code></li>
</ul>

<p>Breaking this command down:</p>

<ol>
<li><p>&rdquo;-D 8080&rdquo; starts SSH tunneling (Socks Proxy) on port 8080 once a connection is made.</p></li>

<li><p>&rdquo;-C&rdquo; requests compression so that we can get the best speeds possible.</p></li>

<li><p>&rdquo;-o ProxyCommand&rdquo; sets the SSH option to the location of the droute.pl script and&hellip;</p></li>

<li><p>&ldquo;whatever.ihaztunnel.room362.com&rdquo; the &lsquo;whatever&rsquo; portion of this is the important part. It can be whatever you want it to be but the &ldquo;magic&rdquo; happens by adding this subdomain of the one you already set up.</p></li>

<li><p>&ldquo;room362.com&rdquo; the hostname or IP of the SSH server that you will be tunneling through.</p></li>
</ol>

<p>If all worked out, you will get prompted to enter your password. That&rsquo;s it folks. Now you can use FoxyProxy or just your standard proxy settings to use the tunnel. Or, you can use product that, IMHO, is well worth the 30 bucks for the PORTABLE EDITION: <a href="http://www.proxifier.com/">Proxifier</a>. It hooks the OS and makes every connection go through the proxy (games, IM, Java, Flash).</p>

<p>Notes:</p>

<p><strong>Before you go the DNS route</strong>, it might pay off to try the ?.jpg trick first. Check out the <a href="http://debuggable.com/posts/hacking-a-commercial-airport-wlan:480f4dd5-50a0-40c6-aa60-4afccbdd56cb">debuggable.com post</a> for more details. - Thanks Xanfantasy for the memory jog.</p>

<p><a href="http://www.dnstunnel.de/">http://www.dnstunnel.de/</a> - A site that has an in-depth walk-through of setting up OzymanDNS if I didn&rsquo;t answer all of your questions. They even have a script that will make OzymanDNS a service on Linux boxes</p>

<p><a href="http://thomer.com/howtos/nstx.html">http://thomer.com/howtos/nstx.html</a> - A write up on NSTX which doesn&rsquo;t require SSH but doesn&rsquo;t look like it&rsquo;s still  in production. It is however in the Ubuntu and Gentoo repositories so feel free to mess with it there, and since <a href="http://backtrack4.blogspot.com/">Back|Track 4</a> is now Ubuntu based you may be able to get it set up on BT4 as well.</p>

<p>Iodine:<br />
<a href="http://code.kryo.se/iodine/">http://code.kryo.se/iodine/</a> - Another DNS Tunneling project that looks to be the most up to date. I haven&rsquo;t tested it out to make sure it functions.</p>

<p>Dns2tcp:<br />
<a href="http://www.hsc.fr/ressources/outils/dns2tcp/index.html.en">http://www.hsc.fr/ressources/outils/dns2tcp/index.html.en</a> - Another DNS Tunneling Project</p>

<p>And if DNS isn&rsquo;t your thing and you want to tunnel over HTTP, check out Corkscrew:  <a href="http://www.agroman.net/corkscrew/">http://www.agroman.net/corkscrew/</a></p>

	
			

			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/post/2009/2009-03-11-the-ethics-of-teaching-hacking/">The Ethics of Teaching Hacking</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/post/2009/2009-03-09-metasploit-3s-microsoft/">Metasploit &lt;3s Microsoft</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;
    if (window.location.hostname == "127.0.0.1")
        return;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'room362';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
			<li><a href="/about">About</a></li>
		
			<li><a href="/post">Blog</a></li>
		
		</ul>
	</div>

	<p>&copy; 2016. All rights reserved.</p>
</div>
    </div>
  </div>
	

	

  
</body>
</html>
