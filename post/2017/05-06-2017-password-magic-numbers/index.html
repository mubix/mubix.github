<!DOCTYPE html>
<html>

    <head>
        <title> Password Magic Numbers &middot;  </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.52" />


<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://malicious.link/css/nix.css">


<link href="https://fonts.googleapis.com/css?family=Inconsolata|Open+Sans|Roboto|Montserrat|Concert+One" rel="stylesheet">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
	  ga('send', 'pageview');

</script>


    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" id="green-terminal" href=https://malicious.link/>mubix@malicious.link ~ $</a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="https://malicious.link/">/home/mubix</a>
				</li>

				
				
				<li >
					<a href="/brandon">~/brandon</a>
				</li>
				
				
				<li >
					<a href="/start">~/start</a>
				</li>
				
				
				<li >
					<a href="/about">~/about</a>
				</li>
				
				
				<li >
					<a href="/post">~/posts</a>
				</li>
				

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="container wrapper">
            <h1><a href="https://malicious.link/post/2017/05-06-2017-password-magic-numbers/">Password Magic Numbers</a></h1>
            <span class="post-date">May 6, 2017 </span>
            <div class="post-content">
                <p><a href="https://en.wikipedia.org/wiki/LAN_Manager">LanManager passwords</a> (&ldquo;LM&rdquo;) is a very old and well known password hashing function. Used way back in <a href="https://en.wikipedia.org/wiki/OS/2">OS/2 Warp</a> and <a href="https://en.wikipedia.org/wiki/MS-Net">MS-Net</a> (networking for MS-DOS). It was great in it&rsquo;s day, however how it worked was not sustainable. The hashing was performed only haver uppercasing and splitting the password into two 7 character chunks. This meant that even if your password was 14 characters long, it was still technically only two 7 character passwords, that could be cracked separately.</p>

<p><a href="https://en.wikipedia.org/wiki/NT_LAN_Manager">NTLM</a>, it&rsquo;s big brother came along with Windows NT (Windows 95 and Windows 98 did not have NTLM, and we don&rsquo;t speak about Windows ME). Windows to this day stores both the LM and NTLM versions of passwords. This meant that if your password was under 15 characters it would still be stored in that LM crackable format (<a href="https://support.microsoft.com/en-us/help/299656/how-to-prevent-windows-from-storing-a-lan-manager-hash-of-your-password-in-active-directory-and-local-sam-databases">unless storage of LM is being prevented, which has become default</a>).</p>

<p>This is where the first &ldquo;magic number&rdquo; for passwords comes from. In many pentests I recommended in my reports that all sensitive passwords have a minimum of <strong>15 characters</strong>. By doing this, no matter what the setting was for the storage of their passwords on whatever system they might be stored on, it would never be stored in LM. I even recommended it for normal users, but obviously that recommendation never stuck.</p>

<p>Recently I discovered a new &ldquo;magic number&rdquo; for passwords: <strong>28</strong>.</p>

<p>Before I get into this, all of this information came from <a href="https://twitter.com/hashcat">Atom</a> (Hashcat primary developer) <a href="https://twitter.com/SolarDiz">Solar Designer</a> (John the Ripper) and <a href="https://github.com/magnumripper">Magnum</a> (John the Ripper). I&rsquo;m just putting it together because I had no idea this existed and I&rsquo;ve been cracking passwords using both of these tools for ages. Huge thanks to them for all their help and patience.</p>

<p>It turns out, that password cracking tools have maximum character lengths for passwords. This boggled my mind for a while but it makes total sense once Atom explained that it has to do with how the tools store the password candidates (dictionary words or generated clear texts to be used in the hash comparison attempt). They are stored in GPU registers, and unfortunately the speed of storing it there comes at a price. That price is that there isn&rsquo;t enough registers to store candidates over certain lengths. The maximum lengths are specific to how each hashing function works so some maximum lengths are longer than others. The general rule of thumb at least in the world of Hashcat is 55 characters.</p>

<p><strong>UPDATE:</strong></p>

<blockquote>
<p>The primary reason behind these specific length limits is that exceeding them doubles the amount of processing. The register pressure is a secondary aspect, and mostly limited to GPUs. (On CPUs, the candidate passwords themselves are not in registers.)</p>

<p>&ndash; Solar Designer</p>

<p><a href="https://twitter.com/solardiz/status/861183622950334464">https://twitter.com/solardiz/status/861183622950334464</a></p>
</blockquote>

<p>In the world of Windows however, passwords are stored using UTF16-LE. This means that password candidates are automatically double the character length as most other hashing functions, halving the possible maximum down to 27 characters. This means that lets say your password is a very well known quote like:</p>

<blockquote>
<p>You can&rsquo;t handle the truth!</p>
</blockquote>

<p>who&rsquo;s NTLM hash is <code>E478B144E719CFF85A5F2028F0DF1808</code> you wouldn&rsquo;t be able to crack it, even if it was in your dictionary, because it&rsquo;s 28 characters. This limitation extends to any UTF16 based hash (which almost all Windows based hashing is)</p>

<p>How do you know what the limits are? Well John the Ripper has a handy dandy argument that tells you specifics of each format:</p>

<pre><code>root@crackingbox:/opt/jtr/run# ./john --list=format-details --format=nt
NT      81      24      24      0002000f        43      MD4 256/256 AVX2 8x3  
</code></pre>

<p>As you can see in the second column it says &ldquo;81&rdquo;. This is the maximum number of UTF8 characters that it can fit for that format type, but because John the Ripper supports up to the full standard of 3 bytes in UTF16, the maximum again, is 27 characters.</p>

<p>You can read more here:</p>

<ul>
<li><a href="https://github.com/magnumripper/JohnTheRipper/issues/2529">https://github.com/magnumripper/JohnTheRipper/issues/2529</a></li>
<li><a href="http://www.openwall.com/lists/john-users/2017/05/04/8">http://www.openwall.com/lists/john-users/2017/05/04/8</a></li>
<li><a href="http://www.openwall.com/lists/john-users/2017/05/04/9">http://www.openwall.com/lists/john-users/2017/05/04/9</a></li>
</ul>

<p>If you read through the openwall posts then you saw there is a way to compile <a href="https://github.com/magnumripper/JohnTheRipper">John (jumbo)</a> to squeeze out a few more characters:</p>

<p>(<strong>This will slow down cracking considerably</strong>)</p>

<pre><code>root@crackingbox:/opt/bigjohn/src/#./configure --disable-native-tests CFLAGS='-O2 -mno-sse2 -mno-mmx -U__SSE__'
</code></pre>

<p>Lets see what this gets us:</p>

<pre><code>root@crackingbox:/opt/bigjohn/run/# ./john --list=format-details --format=nt
NT      125     1       1       0002000f        43      MD4 32/64
</code></pre>

<p>We now have 125 total characters total (not just 41 - <a href="https://twitter.com/solardiz/status/861182438818684929">thanks Solar Designer for the update</a>). And as you can probably guess, it cracks the password just fine now:</p>

<pre><code>root@crackingbox:/opt/bigjohn/run/# ./john /tmp/hashtest.txt --format=nt --wordlist=/tmp/list.txt
Using default input encoding: UTF-8
Loaded 2 password hashes with no different salts (NT [MD4 32/64])
Remaining 1 password hash
Press 'q' or Ctrl-C to abort, almost any other key for status
You can't handle the truth! (Martha)
1g 0:00:00:00 DONE (2017-05-07 00:58) 33.33g/s 133.3p/s 133.3c/s 133.3C/s You can't handle the truth!
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
</code></pre>

<p>Hashcat also has a branch that supports longer passwords, but currently doesn&rsquo;t support NTLM:</p>

<p><a href="https://github.com/hashcat/hashcat/tree/longer_passwords">https://github.com/hashcat/hashcat/tree/longer_passwords</a></p>

<p>So now my recommendations for passwords, at least in the Windows world is 28 characters or more makes it so that without tweaking, your 28 character Jack Nicholson quote based password is safer (I mean, Mimikatz still works, and keyloggers, and so on and so forth&hellip;)</p>

<p>28 characters is a bit tough to force on standard users, but making sure that at least your service, admin and &ldquo;high risk&rdquo; accounts are &gt; 28 is a good step.</p>

<p>Solar Designer also pointed me at the Openwall product called <a href="http://www.openwall.com/passwdqc/">passwdqc</a> which is much more affordable than other password products I&rsquo;ve seen for enterprises. Here is a direct link to the Windows version that allows 30 day trial: <a href="http://www.openwall.com/passwdqc/windows/">http://www.openwall.com/passwdqc/windows/</a></p>

<p><em>I definitely could get things wrong in this post, it&rsquo;s very new to me and I&rsquo;m still digging. Please hit me up with any corrections via comments below, Facbook, Twitter, IRC, Google Hangouts, Wire, Signal, AIM, Slack, LinkedIn, Mastadon, WhatsApp, Skype, smoke signals&hellip; however you wish, I&rsquo;ll update this post as needed. Thanks!</em></p>

<p>&ndash;
mubix</p>

            </div>
            
            <div class="post-comments">
                
            </div>
            
            <div class="push"></div>
        </div>
        <footer class="footer text-center">
<p>Copyright &copy; 2018 Malicious.Link -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>

</footer>

    </body>
